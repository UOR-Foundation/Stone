<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Stone Dashboard</title>
  <style>
    body { 
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Open Sans", "Helvetica Neue", sans-serif; 
      margin: 0; 
      padding: 0; 
      line-height: 1.6;
      color: #24292e;
      background-color: #f6f8fa;
    }
    
    .container { 
      max-width: 1200px; 
      margin: 0 auto; 
      padding: 2rem; 
    }
    
    header { 
      background-color: #0366d6; 
      padding: 1rem 0; 
      text-align: center;
      color: white;
    }
    
    h1 { 
      color: white; 
      margin-bottom: 0.5rem;
    }
    
    header p {
      opacity: 0.9;
      margin-top: 0;
    }
    
    .card { 
      background-color: white; 
      border-radius: 5px; 
      box-shadow: 0 2px 5px rgba(0,0,0,0.1); 
      padding: 1.5rem; 
      margin-bottom: 1.5rem; 
    }
    
    .coming-soon { 
      text-align: center; 
      padding: 2rem; 
      background-color: #f9f9f9; 
      border-radius: 5px; 
      margin: 2rem 0; 
      border: 1px dashed #d1d5da;
    }
    
    .coming-soon h2 {
      color: #0366d6;
    }
    
    a {
      color: #0366d6;
      text-decoration: none;
    }
    
    a:hover {
      text-decoration: underline;
    }
    
    pre {
      background-color: #f6f8fa;
      padding: 1rem;
      border-radius: 5px;
      overflow-x: auto;
      border: 1px solid #e1e4e8;
    }
    
    .stats { 
      display: flex; 
      justify-content: space-between; 
      margin: 2rem 0; 
    }
    
    .stat-card { 
      flex: 1; 
      margin: 0 1rem; 
      padding: 1.5rem; 
      background-color: white; 
      border-radius: 5px; 
      box-shadow: 0 2px 5px rgba(0,0,0,0.1); 
      text-align: center; 
    }
    
    .stat-card:first-child {
      margin-left: 0;
    }
    
    .stat-card:last-child {
      margin-right: 0;
    }
    
    .stat-number { 
      font-size: 2.5rem; 
      font-weight: bold; 
      color: #0366d6; 
      margin-bottom: 0.5rem; 
    }
    
    .stat-label { 
      font-size: 1rem; 
      color: #586069; 
    }
    
    footer { 
      background-color: #24292e; 
      padding: 1rem 0; 
      text-align: center; 
      margin-top: 2rem;
      color: #ffffff;
    }
    
    footer a {
      color: #79b8ff;
    }
    
    /* Dashboard components */
    .dashboard-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      grid-gap: 1.5rem;
    }
    
    .dashboard-card {
      background-color: white;
      border-radius: 5px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
      padding: 1.5rem;
      transition: all 0.3s ease;
    }
    
    .dashboard-card:hover {
      box-shadow: 0 4px 10px rgba(0,0,0,0.15);
      transform: translateY(-2px);
    }
    
    .dashboard-card h3 {
      margin-top: 0;
      color: #0366d6;
      border-bottom: 1px solid #e1e4e8;
      padding-bottom: 0.5rem;
    }
    
    .dashboard-card h4 {
      color: #444;
      margin-top: 1.5rem;
      margin-bottom: 0.5rem;
    }
    
    .metrics {
      margin: 0;
      padding: 0;
      list-style: none;
    }
    
    .metrics li {
      display: flex;
      justify-content: space-between;
      padding: 0.7rem 0;
      border-bottom: 1px solid #f1f1f1;
    }
    
    .metrics li:last-child {
      border-bottom: none;
    }
    
    .metrics li .metric-value {
      font-weight: bold;
      color: #24292e;
    }
    
    .progress-bar-container {
      width: 100%;
      height: 10px;
      background-color: #f1f1f1;
      border-radius: 5px;
      overflow: hidden;
      margin: 0.5rem 0 1rem 0;
    }
    
    .progress-bar {
      height: 100%;
      background-color: #2cbe4e;
      border-radius: 5px;
      transition: width 0.5s ease-in-out;
    }
    
    .progress-status {
      display: flex;
      justify-content: space-between;
      font-size: 0.875rem;
      color: #586069;
    }
    
    .stage-list {
      margin: 1rem 0;
      padding: 0;
      list-style: none;
      display: flex;
      align-items: center;
    }
    
    .stage-item {
      flex: 1;
      text-align: center;
      position: relative;
    }
    
    .stage-item::after {
      content: "";
      position: absolute;
      top: 50%;
      right: 0;
      height: 2px;
      width: 100%;
      background-color: #e1e4e8;
      z-index: 1;
    }
    
    .stage-item:last-child::after {
      display: none;
    }
    
    .stage-indicator {
      width: 24px;
      height: 24px;
      background-color: #e1e4e8;
      border-radius: 50%;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      margin-bottom: 0.5rem;
      position: relative;
      z-index: 2;
      transition: all 0.3s ease;
    }
    
    .stage-item.completed .stage-indicator {
      background-color: #2cbe4e;
      color: white;
    }
    
    .stage-item.current .stage-indicator {
      background-color: #0366d6;
      color: white;
      box-shadow: 0 0 0 3px rgba(3, 102, 214, 0.3);
    }
    
    .stage-name {
      font-size: 0.75rem;
      color: #586069;
    }
    
    .bottleneck-list {
      margin: 0;
      padding: 0;
      list-style: none;
    }
    
    .bottleneck-item {
      padding: 0.75rem;
      margin-bottom: 0.75rem;
      background-color: #fff8f8;
      border-left: 3px solid #d73a4a;
      border-radius: 3px;
      transition: all 0.2s ease;
    }
    
    .bottleneck-item:hover {
      background-color: #ffe5e5;
    }
    
    .bottleneck-name {
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    
    .bottleneck-impact {
      display: inline-block;
      padding: 0.25rem 0.5rem;
      background-color: #d73a4a;
      color: white;
      border-radius: 3px;
      font-size: 0.75rem;
    }
    
    .chart-container {
      width: 100%;
      height: 200px;
      margin: 1rem 0;
    }
    
    .repo-selector {
      margin: 1rem 0;
      padding: 0.75rem;
      width: 100%;
      border: 1px solid #e1e4e8;
      border-radius: 5px;
      background-color: white;
      font-size: 1rem;
      transition: border-color 0.2s ease;
    }
    
    .repo-selector:focus {
      border-color: #0366d6;
      outline: none;
      box-shadow: 0 0 0 3px rgba(3, 102, 214, 0.3);
    }
    
    .filter-controls {
      display: flex;
      margin: 1rem 0;
      gap: 1rem;
      flex-wrap: wrap;
    }
    
    .filter-controls select, 
    .filter-controls input {
      padding: 0.75rem;
      border: 1px solid #e1e4e8;
      border-radius: 5px;
      background-color: white;
      min-width: 150px;
      font-size: 0.9rem;
    }
    
    .login-button {
      display: inline-block;
      padding: 0.75rem 1.25rem;
      background-color: #2ea44f;
      color: white;
      border: none;
      border-radius: 5px;
      font-size: 1rem;
      cursor: pointer;
      text-decoration: none;
      transition: background-color 0.2s ease, transform 0.1s ease;
    }
    
    .login-button:hover {
      background-color: #22863a;
      text-decoration: none;
      transform: translateY(-1px);
    }
    
    .login-button:active {
      transform: translateY(1px);
    }
    
    /* Loading animation */
    @keyframes spin {
      to { transform: rotate(360deg); }
    }
    
    /* Responsive styles */
    @media (max-width: 768px) {
      .stats {
        flex-direction: column;
      }
      
      .stat-card {
        margin: 0.5rem 0;
      }
      
      .dashboard-grid {
        grid-template-columns: 1fr;
      }
      
      .filter-controls {
        flex-direction: column;
      }
    }
  </style>
</head>
<body>
  <header>
    <div class="container">
      <h1>Stone Dashboard</h1>
      <p>A software factory for GitHub-based development using Claude Code</p>
    </div>
  </header>
  
  <div class="container">
    <div class="card">
      <h2>Welcome to Stone</h2>
      <p>Stone is a structured system for orchestrating GitHub-based development using Claude Code. It manages the software development process through specialized roles, each with defined responsibilities and boundaries.</p>
      
      <div id="auth-container" class="coming-soon">
        <h2>GitHub Authentication</h2>
        <p>Connect with your GitHub account to view your repositories and issues.</p>
        <a href="#" class="login-button" id="login-button">
          <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16" style="vertical-align: text-bottom; margin-right: 0.5rem;">
            <path fill="currentColor" d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0 0 16 8c0-4.42-3.58-8-8-8z"/>
          </svg>
          Sign in with GitHub
        </a>
      </div>
    </div>
    
    <div class="stats">
      <div class="stat-card">
        <div class="stat-number">5</div>
        <div class="stat-label">AI Roles</div>
      </div>
      <div class="stat-card">
        <div class="stat-number">8</div>
        <div class="stat-label">Workflow Steps</div>
      </div>
      <div class="stat-card">
        <div class="stat-number">3</div>
        <div class="stat-label">Publishing Options</div>
      </div>
    </div>
    
    <div id="dashboard-content" style="display: none;">
      <div class="filter-controls">
        <select id="repo-selector" class="repo-selector">
          <option value="">Select a repository</option>
        </select>
        <select id="time-period">
          <option value="7">Last 7 days</option>
          <option value="30" selected>Last 30 days</option>
          <option value="90">Last 90 days</option>
          <option value="365">Last year</option>
        </select>
      </div>
      
      <div class="dashboard-grid">
        <div class="dashboard-card">
          <h3>Issue Status</h3>
          <ul class="metrics" id="issue-metrics">
            <li>
              <span class="metric-name">Total Issues</span>
              <span class="metric-value" id="total-issues">Loading...</span>
            </li>
            <li>
              <span class="metric-name">Open Issues</span>
              <span class="metric-value" id="open-issues">Loading...</span>
            </li>
            <li>
              <span class="metric-name">Closed Issues</span>
              <span class="metric-value" id="closed-issues">Loading...</span>
            </li>
          </ul>
          
          <h4>Completion Progress</h4>
          <div class="progress-bar-container">
            <div class="progress-bar" id="completion-progress" style="width: 0%"></div>
          </div>
          <div class="progress-status">
            <span>0%</span>
            <span id="completion-percentage">0%</span>
          </div>
        </div>
        
        <div class="dashboard-card">
          <h3>Pull Request Status</h3>
          <ul class="metrics" id="pr-metrics">
            <li>
              <span class="metric-name">Total PRs</span>
              <span class="metric-value" id="total-prs">Loading...</span>
            </li>
            <li>
              <span class="metric-name">Open PRs</span>
              <span class="metric-value" id="open-prs">Loading...</span>
            </li>
            <li>
              <span class="metric-name">Closed PRs</span>
              <span class="metric-value" id="closed-prs">Loading...</span>
            </li>
          </ul>
          
          <h4>Merge Rate</h4>
          <div class="progress-bar-container">
            <div class="progress-bar" id="merge-progress" style="width: 0%"></div>
          </div>
          <div class="progress-status">
            <span>0%</span>
            <span id="merge-percentage">0%</span>
          </div>
        </div>
        
        <div class="dashboard-card">
          <h3>Performance Metrics</h3>
          <ul class="metrics" id="performance-metrics">
            <li>
              <span class="metric-name">Average Time to Completion</span>
              <span class="metric-value" id="avg-completion-time">Loading...</span>
            </li>
            <li>
              <span class="metric-name">Average PR Review Time</span>
              <span class="metric-value" id="avg-review-time">Loading...</span>
            </li>
            <li>
              <span class="metric-name">Issues Completed This Month</span>
              <span class="metric-value" id="issues-completed">Loading...</span>
            </li>
          </ul>
        </div>
        
        <div class="dashboard-card">
          <h3>Workflow Bottlenecks</h3>
          <ul class="bottleneck-list" id="bottleneck-list">
            <li class="bottleneck-item">
              <span class="bottleneck-name">Loading bottlenecks...</span>
            </li>
          </ul>
        </div>
        
        <div class="dashboard-card">
          <h3>Workflow Stage Progress</h3>
          <div id="stage-progress">
            <ul class="stage-list">
              <li class="stage-item completed">
                <div class="stage-indicator">1</div>
                <div class="stage-name">Planning</div>
              </li>
              <li class="stage-item current">
                <div class="stage-indicator">2</div>
                <div class="stage-name">Implementation</div>
              </li>
              <li class="stage-item">
                <div class="stage-indicator">3</div>
                <div class="stage-name">QA</div>
              </li>
              <li class="stage-item">
                <div class="stage-indicator">4</div>
                <div class="stage-name">Audit</div>
              </li>
              <li class="stage-item">
                <div class="stage-indicator">5</div>
                <div class="stage-name">Release</div>
              </li>
            </ul>
          </div>
        </div>
        
        <div class="dashboard-card">
          <h3>Label Distribution</h3>
          <div id="label-distribution">
            <ul class="metrics" id="label-metrics">
              <li>
                <span class="metric-name">Loading labels...</span>
                <span class="metric-value">...</span>
              </li>
            </ul>
          </div>
        </div>
      </div>
    </div>
    
    <div class="coming-soon">
      <h2>Interactive Dashboard Coming Soon</h2>
      <p>Our fully interactive dashboard with real-time workflow visualization, metrics, and performance analytics is being developed.</p>
      <p>The dashboard will provide a complete view of your Stone workflows, helping you identify bottlenecks and optimize your development process.</p>
      <p>Check back for updates or visit our <a href="https://github.com/UOR-Foundation/Stone">GitHub repository</a> for more information.</p>
    </div>
    
    <div class="card">
      <h2>Getting Started</h2>
      <pre>npm install --save-dev @uor-foundation/stone</pre>
      <p>Initialize Stone in your repository:</p>
      <pre>npx stone init</pre>
    </div>
  </div>
  
  <footer>
    <div class="container">
      <p>© 2025 UOR Foundation - <a href="https://github.com/UOR-Foundation/Stone">GitHub</a></p>
    </div>
  </footer>

  <script>
    // Stone Dashboard JavaScript - This integrates with the Stone StatusDashboard, ProgressVisualization, and PerformanceAnalytics
    document.addEventListener('DOMContentLoaded', function() {
      const loginButton = document.getElementById('login-button');
      const authContainer = document.getElementById('auth-container');
      const dashboardContent = document.getElementById('dashboard-content');
      const comingSoonNotice = document.querySelector('.coming-soon');
      
      // Authentication handling - in a real implementation, this would interface with GitHub OAuth
      loginButton.addEventListener('click', function(e) {
        e.preventDefault();
        
        // For demo purposes, simulate authentication with a loading period
        loginButton.disabled = true;
        loginButton.innerHTML = '<span style="display: inline-block; width: 20px; height: 20px; border: 2px solid white; border-top-color: transparent; border-radius: 50%; margin-right: 10px; vertical-align: middle; animation: spin 1s linear infinite;"></span> Authenticating...';
        
        setTimeout(() => {
          authContainer.style.display = 'none';
          dashboardContent.style.display = 'block';
          comingSoonNotice.style.display = 'none';
          
          // Initialize dashboard
          initializeDashboard();
        }, 1000);
      });
      
      // This would connect to the actual Stone API in a production environment
      class StoneDashboardAPI {
        constructor() {
          this.token = null;
          this.mockMode = true; // Mock data mode toggle
        }
        
        authenticate(token) {
          this.token = token;
          return Promise.resolve({ success: true });
        }
        
        // Main method to get status data - maps to StatusDashboard.getStatusData()
        async getStatusData(repoId) {
          if (this.mockMode) {
            return this.getMockStatusData(repoId);
          }
          
          // In a real implementation, this would call the actual API
          try {
            const response = await fetch('/api/status', {
              headers: {
                'Authorization': `Bearer ${this.token}`,
                'Content-Type': 'application/json'
              },
              body: JSON.stringify({ repository: repoId })
            });
            
            return await response.json();
          } catch (error) {
            console.error('Failed to fetch status data:', error);
            return this.getMockStatusData(repoId); // Fallback to mock data on error
          }
        }
        
        // Get performance metrics - maps to StatusDashboard.getPerformanceMetrics()
        async getPerformanceMetrics(repoId) {
          if (this.mockMode) {
            return this.getMockPerformanceData(repoId);
          }
          
          // In a real implementation, this would call the actual API
          try {
            const response = await fetch('/api/performance', {
              headers: {
                'Authorization': `Bearer ${this.token}`,
                'Content-Type': 'application/json'
              },
              body: JSON.stringify({ repository: repoId })
            });
            
            return await response.json();
          } catch (error) {
            console.error('Failed to fetch performance metrics:', error);
            return this.getMockPerformanceData(repoId);
          }
        }
        
        // Get bottlenecks - maps to StatusDashboard.identifyBottlenecks()
        async getBottlenecks(repoId) {
          if (this.mockMode) {
            return this.getMockBottlenecks(repoId);
          }
          
          // In a real implementation, this would call the actual API
          try {
            const response = await fetch('/api/bottlenecks', {
              headers: {
                'Authorization': `Bearer ${this.token}`,
                'Content-Type': 'application/json'
              },
              body: JSON.stringify({ repository: repoId })
            });
            
            return await response.json();
          } catch (error) {
            console.error('Failed to fetch bottlenecks:', error);
            return this.getMockBottlenecks(repoId);
          }
        }
        
        // Get workflow progress - maps to ProgressVisualization.generateWorkflowGraph()
        async getWorkflowProgress(repoId) {
          if (this.mockMode) {
            return this.getMockWorkflowStages(repoId);
          }
          
          // In a real implementation, this would call the actual API
          try {
            const response = await fetch('/api/workflow-progress', {
              headers: {
                'Authorization': `Bearer ${this.token}`,
                'Content-Type': 'application/json'
              },
              body: JSON.stringify({ repository: repoId })
            });
            
            return await response.json();
          } catch (error) {
            console.error('Failed to fetch workflow progress:', error);
            return this.getMockWorkflowStages(repoId);
          }
        }
        
        // Get repository list
        async getRepositories() {
          if (this.mockMode) {
            return [
              { name: 'UOR-Foundation/Stone', id: 'stone' },
              { name: 'UOR-Foundation/Example', id: 'example' },
              { name: 'UOR-Foundation/Demo', id: 'demo' }
            ];
          }
          
          // In a real implementation, this would call the GitHub API
          try {
            const response = await fetch('/api/repositories', {
              headers: { 'Authorization': `Bearer ${this.token}` }
            });
            
            return await response.json();
          } catch (error) {
            console.error('Failed to fetch repositories:', error);
            return [
              { name: 'UOR-Foundation/Stone', id: 'stone' }
            ];
          }
        }
        
        // Mock data methods - these simulate the structure of actual Stone API responses
        getMockStatusData(repoId) {
          const mockData = {
            stone: {
              issues: { total: 42, open: 12, closed: 30 },
              pullRequests: { total: 38, open: 5, closed: 33 },
              labelDistribution: {
                'stone': 14,
                'stone-qa': 8,
                'stone-feature-implement': 10,
                'stone-audit': 5,
                'bug': 7,
                'enhancement': 12,
                'documentation': 5
              }
            },
            example: {
              issues: { total: 24, open: 8, closed: 16 },
              pullRequests: { total: 20, open: 3, closed: 17 },
              labelDistribution: {
                'stone': 8,
                'stone-qa': 5,
                'stone-feature-implement': 6,
                'stone-audit': 3,
                'bug': 10,
                'enhancement': 5,
                'documentation': 2
              }
            },
            demo: {
              issues: { total: 15, open: 3, closed: 12 },
              pullRequests: { total: 14, open: 1, closed: 13 },
              labelDistribution: {
                'stone': 5,
                'stone-qa': 3,
                'stone-feature-implement': 4,
                'stone-audit': 2,
                'bug': 3,
                'enhancement': 8,
                'documentation': 1
              }
            }
          };
          
          return Promise.resolve(mockData[repoId] || mockData.stone);
        }
        
        getMockPerformanceData(repoId) {
          const mockPerformanceData = {
            stone: {
              averageTimeToCompletion: 259200000, // 3 days in milliseconds
              stageMetrics: {
                'stone-feature-implement': {
                  averageTime: 129600000, // 1.5 days in milliseconds
                  minTime: 43200000, // 12 hours in milliseconds
                  maxTime: 345600000 // 4 days in milliseconds
                },
                'stone-qa': {
                  averageTime: 86400000, // 1 day in milliseconds
                  minTime: 43200000, // 12 hours in milliseconds
                  maxTime: 172800000 // 2 days in milliseconds
                },
                'stone-audit': {
                  averageTime: 43200000, // 12 hours in milliseconds
                  minTime: 21600000, // 6 hours in milliseconds
                  maxTime: 86400000 // 1 day in milliseconds
                }
              }
            },
            example: {
              averageTimeToCompletion: 172800000, // 2 days in milliseconds
              stageMetrics: {
                'stone-feature-implement': {
                  averageTime: 43200000, // 12 hours in milliseconds
                  minTime: 21600000, // 6 hours in milliseconds
                  maxTime: 86400000 // 1 day in milliseconds
                },
                'stone-qa': {
                  averageTime: 86400000, // 1 day in milliseconds
                  minTime: 43200000, // 12 hours in milliseconds
                  maxTime: 172800000 // 2 days in milliseconds
                },
                'stone-audit': {
                  averageTime: 43200000, // 12 hours in milliseconds
                  minTime: 21600000, // 6 hours in milliseconds
                  maxTime: 86400000 // 1 day in milliseconds
                }
              }
            },
            demo: {
              averageTimeToCompletion: 86400000, // 1 day in milliseconds
              stageMetrics: {
                'stone-feature-implement': {
                  averageTime: 28800000, // 8 hours in milliseconds
                  minTime: 14400000, // 4 hours in milliseconds
                  maxTime: 43200000 // 12 hours in milliseconds
                },
                'stone-qa': {
                  averageTime: 28800000, // 8 hours in milliseconds
                  minTime: 14400000, // 4 hours in milliseconds
                  maxTime: 43200000 // 12 hours in milliseconds
                },
                'stone-audit': {
                  averageTime: 28800000, // 8 hours in milliseconds
                  minTime: 14400000, // 4 hours in milliseconds
                  maxTime: 43200000 // 12 hours in milliseconds
                }
              }
            }
          };
          
          return Promise.resolve(mockPerformanceData[repoId] || mockPerformanceData.stone);
        }
        
        getMockBottlenecks(repoId) {
          const mockBottlenecks = {
            stone: [
              { stage: 'stone-feature-implement', averageTime: 129600000, impact: 0.45 },
              { stage: 'stone-qa', averageTime: 86400000, impact: 0.3 }
            ],
            example: [
              { stage: 'stone-qa', averageTime: 86400000, impact: 0.5 }
            ],
            demo: []
          };
          
          return Promise.resolve(mockBottlenecks[repoId] || []);
        }
        
        getMockWorkflowStages(repoId) {
          const mockStages = {
            stone: [
              { name: 'Planning', label: 'stone', completed: true, current: false },
              { name: 'Implementation', label: 'stone-feature-implement', completed: true, current: false },
              { name: 'QA', label: 'stone-qa', completed: false, current: true, timeSpent: 43200000 },
              { name: 'Audit', label: 'stone-audit', completed: false, current: false },
              { name: 'Release', label: 'stone-release', completed: false, current: false }
            ],
            example: [
              { name: 'Planning', label: 'stone', completed: true, current: false },
              { name: 'Implementation', label: 'stone-feature-implement', completed: true, current: false },
              { name: 'QA', label: 'stone-qa', completed: true, current: false },
              { name: 'Audit', label: 'stone-audit', completed: false, current: true, timeSpent: 21600000 },
              { name: 'Release', label: 'stone-release', completed: false, current: false }
            ],
            demo: [
              { name: 'Planning', label: 'stone', completed: true, current: false },
              { name: 'Implementation', label: 'stone-feature-implement', completed: false, current: true, timeSpent: 14400000 },
              { name: 'QA', label: 'stone-qa', completed: false, current: false },
              { name: 'Audit', label: 'stone-audit', completed: false, current: false },
              { name: 'Release', label: 'stone-release', completed: false, current: false }
            ]
          };
          
          return Promise.resolve(mockStages[repoId] || mockStages.stone);
        }
      }
      
      // Initialize the dashboard - this would connect to the real Stone API
      function initializeDashboard() {
        const api = new StoneDashboardAPI();
        const dashboardManager = new StoneDashboardManager(api);
        dashboardManager.initialize();
      }
      
      // Main dashboard manager class - handles UI updates and API interactions
      class StoneDashboardManager {
        constructor(api) {
          this.api = api;
          this.currentRepo = null;
          
          // Cache DOM elements for better performance
          this.elements = {
            repoSelector: document.getElementById('repo-selector'),
            totalIssues: document.getElementById('total-issues'),
            openIssues: document.getElementById('open-issues'),
            closedIssues: document.getElementById('closed-issues'),
            completionProgress: document.getElementById('completion-progress'),
            completionPercentage: document.getElementById('completion-percentage'),
            totalPRs: document.getElementById('total-prs'),
            openPRs: document.getElementById('open-prs'),
            closedPRs: document.getElementById('closed-prs'),
            mergeProgress: document.getElementById('merge-progress'),
            mergePercentage: document.getElementById('merge-percentage'),
            avgCompletionTime: document.getElementById('avg-completion-time'),
            avgReviewTime: document.getElementById('avg-review-time'),
            issuesCompleted: document.getElementById('issues-completed'),
            bottleneckList: document.getElementById('bottleneck-list'),
            labelMetrics: document.getElementById('label-metrics'),
            stageProgress: document.getElementById('stage-progress')
          };
        }
        
        async initialize() {
          try {
            // Simulate authentication - in a real implementation, this would use the GitHub token
            await this.api.authenticate('mock-token');
            
            // Get repositories
            const repositories = await this.api.getRepositories();
            this.populateRepositorySelector(repositories);
            
            // Select first repository
            if (repositories && repositories.length > 0) {
              this.currentRepo = repositories[0].id;
              this.elements.repoSelector.value = this.currentRepo;
              this.loadRepositoryData(this.currentRepo);
            }
            
            // Add event listeners
            this.elements.repoSelector.addEventListener('change', (e) => {
              this.loadRepositoryData(e.target.value);
            });
            
            // Add time period filter event listener
            const timePeriodSelector = document.getElementById('time-period');
            timePeriodSelector.addEventListener('change', () => {
              this.loadRepositoryData(this.currentRepo);
            });
          } catch (error) {
            console.error('Failed to initialize dashboard:', error);
            this.showError('Failed to initialize dashboard. Please try again later.');
          }
        }
        
        populateRepositorySelector(repositories) {
          const repoSelector = this.elements.repoSelector;
          
          // Clear existing options except the placeholder
          while (repoSelector.options.length > 1) {
            repoSelector.remove(1);
          }
          
          // Add repositories
          repositories.forEach(repo => {
            const option = document.createElement('option');
            option.value = repo.id;
            option.textContent = repo.name;
            repoSelector.appendChild(option);
          });
        }
        
        async loadRepositoryData(repoId) {
          this.currentRepo = repoId;
          
          // Show loading indicators
          this.showLoadingState();
          
          try {
            // Fetch all required data in parallel for better performance
            const [statusData, performanceMetrics, bottlenecks, workflowStages] = await Promise.all([
              this.api.getStatusData(repoId),
              this.api.getPerformanceMetrics(repoId),
              this.api.getBottlenecks(repoId),
              this.api.getWorkflowProgress(repoId)
            ]);
            
            // Update UI with data
            this.updateIssueMetrics(statusData);
            this.updatePRMetrics(statusData);
            this.updatePerformanceMetrics(performanceMetrics);
            this.updateBottlenecks(bottlenecks);
            this.updateLabelDistribution(statusData.labelDistribution);
            this.updateWorkflowStages(workflowStages);
          } catch (error) {
            console.error('Failed to load repository data:', error);
            this.showError('Failed to load repository data. Please try again later.');
          }
        }
        
        updateIssueMetrics(statusData) {
          const { issues } = statusData;
          
          // Update issue counts
          this.elements.totalIssues.textContent = issues.total;
          this.elements.openIssues.textContent = issues.open;
          this.elements.closedIssues.textContent = issues.closed;
          
          // Update completion progress
          const completionPercentage = issues.total > 0
            ? Math.round((issues.closed / issues.total) * 100)
            : 0;
            
          this.elements.completionProgress.style.width = `${completionPercentage}%`;
          this.elements.completionPercentage.textContent = `${completionPercentage}%`;
        }
        
        updatePRMetrics(statusData) {
          const { pullRequests } = statusData;
          
          // Update PR counts
          this.elements.totalPRs.textContent = pullRequests.total;
          this.elements.openPRs.textContent = pullRequests.open;
          this.elements.closedPRs.textContent = pullRequests.closed;
          
          // Update merge rate
          const mergePercentage = pullRequests.total > 0
            ? Math.round((pullRequests.closed / pullRequests.total) * 100)
            : 0;
            
          this.elements.mergeProgress.style.width = `${mergePercentage}%`;
          this.elements.mergePercentage.textContent = `${mergePercentage}%`;
        }
        
        updatePerformanceMetrics(performanceMetrics) {
          // Format times to human-readable strings
          const avgCompletionTime = this.formatTime(performanceMetrics.averageTimeToCompletion);
          
          // Calculate average review time based on stage metrics if available
          let avgReviewTime = '14 hours'; // Default fallback
          if (performanceMetrics.stageMetrics['stone-qa']) {
            avgReviewTime = this.formatTime(performanceMetrics.stageMetrics['stone-qa'].averageTime);
          }
          
          // Calculate issues completed this month (would be from actual API in real implementation)
          const issuesCompletedThisMonth = Math.floor(Math.random() * 15) + 5;
          
          // Update the UI
          this.elements.avgCompletionTime.textContent = avgCompletionTime;
          this.elements.avgReviewTime.textContent = avgReviewTime;
          this.elements.issuesCompleted.textContent = issuesCompletedThisMonth;
        }
        
        updateBottlenecks(bottlenecks) {
          const bottleneckList = this.elements.bottleneckList;
          bottleneckList.innerHTML = '';
          
          // Map stage names to human-readable names
          const stageNames = {
            'stone-feature-implement': 'Implementation',
            'stone-qa': 'QA Testing',
            'stone-audit': 'Audit',
            'stone': 'Planning',
            'stone-release': 'Release'
          };
          
          if (bottlenecks.length === 0) {
            const bottleneckItem = document.createElement('li');
            bottleneckItem.className = 'bottleneck-item';
            bottleneckItem.style.borderColor = '#2cbe4e';
            bottleneckItem.style.backgroundColor = '#f6fff8';
            bottleneckItem.textContent = 'No significant bottlenecks detected.';
            bottleneckList.appendChild(bottleneckItem);
          } else {
            bottlenecks.forEach(bottleneck => {
              const bottleneckItem = document.createElement('li');
              bottleneckItem.className = 'bottleneck-item';
              
              const bottleneckName = document.createElement('div');
              bottleneckName.className = 'bottleneck-name';
              
              // Convert stage name to human-readable name
              const stageName = stageNames[bottleneck.stage] || bottleneck.stage;
              const formattedTime = this.formatTime(bottleneck.averageTime);
              
              bottleneckName.textContent = `${stageName} (${formattedTime})`;
              
              const bottleneckImpact = document.createElement('span');
              bottleneckImpact.className = 'bottleneck-impact';
              bottleneckImpact.textContent = `${Math.round(bottleneck.impact * 100)}% Impact`;
              
              bottleneckItem.appendChild(bottleneckName);
              bottleneckName.appendChild(bottleneckImpact);
              bottleneckList.appendChild(bottleneckItem);
            });
          }
        }
        
        updateLabelDistribution(labelDistribution) {
          const labelMetrics = this.elements.labelMetrics;
          labelMetrics.innerHTML = '';
          
          // Sort labels by count (descending)
          const sortedLabels = Object.entries(labelDistribution)
            .sort(([_, countA], [__, countB]) => countB - countA);
          
          sortedLabels.forEach(([label, count]) => {
            const labelItem = document.createElement('li');
            
            const labelName = document.createElement('span');
            labelName.className = 'metric-name';
            labelName.textContent = label;
            
            const labelCount = document.createElement('span');
            labelCount.className = 'metric-value';
            labelCount.textContent = count;
            
            labelItem.appendChild(labelName);
            labelItem.appendChild(labelCount);
            labelMetrics.appendChild(labelItem);
          });
        }
        
        updateWorkflowStages(stages) {
          const stageProgress = this.elements.stageProgress;
          
          // Create a new stage list
          const stageList = document.createElement('ul');
          stageList.className = 'stage-list';
          
          stages.forEach((stage, index) => {
            const stageItem = document.createElement('li');
            stageItem.className = 'stage-item';
            
            if (stage.completed) {
              stageItem.classList.add('completed');
            }
            
            if (stage.current) {
              stageItem.classList.add('current');
            }
            
            const stageIndicator = document.createElement('div');
            stageIndicator.className = 'stage-indicator';
            stageIndicator.textContent = index + 1;
            
            const stageName = document.createElement('div');
            stageName.className = 'stage-name';
            stageName.textContent = stage.name;
            
            stageItem.appendChild(stageIndicator);
            stageItem.appendChild(stageName);
            stageList.appendChild(stageItem);
          });
          
          // Replace the current stage list
          stageProgress.innerHTML = '';
          stageProgress.appendChild(stageList);
        }
        
        showLoadingState() {
          // Set loading indicators for main metrics
          this.elements.totalIssues.textContent = '...';
          this.elements.openIssues.textContent = '...';
          this.elements.closedIssues.textContent = '...';
          this.elements.totalPRs.textContent = '...';
          this.elements.openPRs.textContent = '...';
          this.elements.closedPRs.textContent = '...';
          this.elements.avgCompletionTime.textContent = 'Loading...';
          this.elements.avgReviewTime.textContent = 'Loading...';
          this.elements.issuesCompleted.textContent = 'Loading...';
          
          // Reset progress bars
          this.elements.completionProgress.style.width = '0%';
          this.elements.completionPercentage.textContent = '0%';
          this.elements.mergeProgress.style.width = '0%';
          this.elements.mergePercentage.textContent = '0%';
        }
        
        showError(message) {
          // Simple error handling - in a real implementation, this would show a toast or alert
          console.error(message);
          
          // Show error state in the UI
          this.elements.totalIssues.textContent = 'Error';
          this.elements.openIssues.textContent = 'Error';
          this.elements.closedIssues.textContent = 'Error';
        }
        
        // Format time in milliseconds to a human-readable string
        // This mirrors the StatusDashboard.formatTime() method
        formatTime(milliseconds) {
          const seconds = Math.floor(milliseconds / 1000);
          
          if (seconds < 60) {
            return `${seconds} seconds`;
          } else if (seconds < 3600) {
            return `${Math.floor(seconds / 60)} minutes`;
          } else if (seconds < 86400) {
            return `${Math.floor(seconds / 3600)} hours`;
          } else {
            return `${Math.floor(seconds / 86400)} days`;
          }
        }
      }
    });
  </script>
</body>
</html>